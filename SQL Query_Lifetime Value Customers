-- Selecting the desired columns and calculating the number of rentals and revenue for each customer
SELECT
  D.country, -- Country of the customer
  C.city, -- City of the customer
  A.first_name, -- First name of the customer
  A.last_name, -- Last name of the customer
  COUNT(E.rental_id) AS number_rental, -- Count of rentals for the customer
  SUM(E.amount) AS revenue -- Total revenue generated by the customer
FROM
  customer A -- Customer table
  JOIN address B ON A.address_id = B.address_id -- Joining customer with address table
  JOIN city C ON B.city_id = C.city_id -- Joining address with city table
  JOIN country D ON C.country_id = D.country_id -- Joining city with country table
  JOIN payment E ON A.customer_id = E.customer_id -- Joining customer with payment table
GROUP BY
  D.country, -- Grouping by country
  C.city, -- Grouping by city
  A.first_name, -- Grouping by first name
  A.last_name -- Grouping by last name
ORDER BY
  revenue DESC; -- Sorting the results in descending order based on revenue

